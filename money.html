<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Finance Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.8); }
        .loading { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .toast { transition: all 0.3s ease; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Toast Notification -->
    <div id="toast" class="fixed top-4 right-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg p-4 border-l-4 border-green-500">
            <div class="flex items-center">
                <span id="toast-message" class="text-gray-800"></span>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 flex items-center space-x-3">
            <div class="loading w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"></div>
            <span class="text-gray-700">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</span>
        </div>
    </div>

    <div class="container mx-auto px-4 py-6 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">üí∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h1>
            <p class="text-gray-600">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex flex-wrap justify-center mb-6 bg-white rounded-lg p-1 shadow-sm">
            <button onclick="showTab('dashboard')" id="tab-dashboard" class="tab-btn px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-500 text-white">
                üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
            </button>
            <button onclick="showTab('transactions')" id="tab-transactions" class="tab-btn px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-blue-500">
                üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </button>
            <button onclick="showTab('categories')" id="tab-categories" class="tab-btn px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-blue-500">
                ‚öôÔ∏è ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content">
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-gradient-to-r from-green-400 to-green-500 rounded-xl p-6 text-white shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p id="total-income" class="text-2xl font-bold">‡∏ø0</p>
                        </div>
                        <div class="text-3xl">üí∞</div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-red-400 to-red-500 rounded-xl p-6 text-white shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-100 text-sm">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p id="total-expenses" class="text-2xl font-bold">‡∏ø0</p>
                        </div>
                        <div class="text-3xl">üßæ</div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-blue-400 to-blue-500 rounded-xl p-6 text-white shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                            <p id="balance" class="text-2xl font-bold">‡∏ø0</p>
                        </div>
                        <div class="text-3xl">üíº</div>
                    </div>
                </div>
            </div>

            <!-- Month/Year Selector -->
            <div class="bg-white rounded-xl p-6 shadow-lg mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
                        <select id="month-filter" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                            <option value="01">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°</option>
                            <option value="02">‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                            <option value="03">‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°</option>
                            <option value="04">‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô</option>
                            <option value="05">‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°</option>
                            <option value="06">‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô</option>
                            <option value="07">‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°</option>
                            <option value="08">‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°</option>
                            <option value="09">‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô</option>
                            <option value="10">‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°</option>
                            <option value="11">‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô</option>
                            <option value="12">‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏µ</label>
                        <select id="year-filter" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>
                        </select>
                    </div>
                </div>
                <button onclick="applyFilters()" class="mt-4 w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                    üîç ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>

            <!-- Add Transaction Form -->
            <div class="bg-white rounded-xl p-6 shadow-lg mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h3>
                
                <!-- Transaction Type Toggle -->
                <div class="flex bg-gray-100 rounded-lg p-1 mb-4">
                    <button onclick="setTransactionType('income')" id="income-tab" class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-green-500 text-white">
                        üíµ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö
                    </button>
                    <button onclick="setTransactionType('expense')" id="expense-tab" class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800">
                        üßæ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
                    </button>
                </div>

                <form id="transaction-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ø)</label>
                        <input type="number" id="amount" step="0.01" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0.00">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                        <div class="flex space-x-2">
                            <select id="category" class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                            </select>
                            <input type="text" id="custom-category" placeholder="‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà" class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="date" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                        <textarea id="note" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>
                    </div>
                    
                    <button type="submit" class="w-full bg-blue-500 text-white py-4 rounded-lg hover:bg-blue-600 transition-colors font-medium text-lg">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    </button>
                </form>
            </div>

            <!-- Expense Chart -->
            <div class="bg-white rounded-xl p-6 shadow-lg mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üìä ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
                <div class="relative h-64">
                    <canvas id="expense-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions-tab" class="tab-content hidden">
            <div class="bg-white rounded-xl p-6 shadow-lg">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                
                <!-- Sync Buttons -->
                <div class="mb-4 flex flex-wrap gap-2">
                    <button onclick="syncWithGoogleSheets()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                        ‚òÅÔ∏è ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Sheets
                    </button>
                    <button onclick="loadFromGoogleSheets()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        üì• ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Sheets
                    </button>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-2 font-medium text-gray-700">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th class="text-left py-3 px-2 font-medium text-gray-700">üìÇ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                <th class="text-right py-3 px-2 font-medium text-gray-700">üí∏ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                <th class="text-left py-3 px-2 font-medium text-gray-700">üßæ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                <th class="text-center py-3 px-2 font-medium text-gray-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-table">
                            <!-- Transactions will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Categories Tab -->
        <div id="categories-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Income Categories -->
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">üíµ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h3>
                    <div class="space-y-2 mb-4">
                        <div id="income-categories-list"></div>
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="new-income-category" placeholder="‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà" class="flex-1 p-2 border border-gray-300 rounded-lg">
                        <button onclick="addCategory('income')" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            ‚ûï
                        </button>
                    </div>
                </div>

                <!-- Expense Categories -->
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">üßæ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
                    <div class="space-y-2 mb-4">
                        <div id="expense-categories-list"></div>
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="new-expense-category" placeholder="‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà" class="flex-1 p-2 border border-gray-300 rounded-lg">
                        <button onclick="addCategory('expense')" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
                            ‚ûï
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby_sdthGBHjgnT7OOaWb6eiKuZs818iIbRS5TTikyens3LEcg6w7fV3JM5G2DF7mVg/exec';
        
        // Global variables
        let currentTransactionType = 'income';
        let transactions = [];
        let filteredTransactions = [];
        let expenseChart = null;
        
        // Default categories
        let categories = {
            income: ['‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', '‡πÇ‡∏ö‡∏ô‡∏±‡∏™', '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢', '‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'],
            expense: ['‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á', '‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á', '‡∏ö‡∏¥‡∏•', '‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', '‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ']
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Set current date
            document.getElementById('date').valueAsDate = new Date();
            
            // Populate year filter
            populateYearFilter();
            
            // Load categories
            loadCategories();
            
            // Load sample data
            loadSampleData();
            
            // Setup form submission
            document.getElementById('transaction-form').addEventListener('submit', handleFormSubmit);
            
            // Setup filters
            document.getElementById('month-filter').addEventListener('change', applyFilters);
            document.getElementById('year-filter').addEventListener('change', applyFilters);
        }

        function populateYearFilter() {
            const yearSelect = document.getElementById('year-filter');
            const currentYear = new Date().getFullYear();
            
            for (let year = currentYear - 5; year <= currentYear + 1; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 543; // Thai Buddhist year
                if (year === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('text-gray-600');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            document.getElementById('tab-' + tabName).classList.add('bg-blue-500', 'text-white');
            document.getElementById('tab-' + tabName).classList.remove('text-gray-600');
            
            // Refresh chart if dashboard tab
            if (tabName === 'dashboard') {
                setTimeout(updateExpenseChart, 100);
            }
        }

        function setTransactionType(type) {
            currentTransactionType = type;
            
            // Update tab appearance
            const incomeTab = document.getElementById('income-tab');
            const expenseTab = document.getElementById('expense-tab');
            
            if (type === 'income') {
                incomeTab.classList.add('bg-green-500', 'text-white');
                incomeTab.classList.remove('text-gray-600');
                expenseTab.classList.remove('bg-red-500', 'text-white');
                expenseTab.classList.add('text-gray-600');
            } else {
                expenseTab.classList.add('bg-red-500', 'text-white');
                expenseTab.classList.remove('text-gray-600');
                incomeTab.classList.remove('bg-green-500', 'text-white');
                incomeTab.classList.add('text-gray-600');
            }
            
            // Update category options
            updateCategoryOptions();
        }

        function updateCategoryOptions() {
            const categorySelect = document.getElementById('category');
            categorySelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>';
            
            categories[currentTransactionType].forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorySelect.appendChild(option);
            });
        }

        function loadCategories() {
            updateCategoryOptions();
            renderCategoriesLists();
        }

        function renderCategoriesLists() {
            // Render income categories
            const incomeList = document.getElementById('income-categories-list');
            incomeList.innerHTML = '';
            categories.income.forEach(cat => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-2 bg-green-50 rounded-lg';
                div.innerHTML = `
                    <span class="text-green-800">${cat}</span>
                    <button onclick="removeCategory('income', '${cat}')" class="text-red-500 hover:text-red-700">
                        üóëÔ∏è
                    </button>
                `;
                incomeList.appendChild(div);
            });

            // Render expense categories
            const expenseList = document.getElementById('expense-categories-list');
            expenseList.innerHTML = '';
            categories.expense.forEach(cat => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-2 bg-red-50 rounded-lg';
                div.innerHTML = `
                    <span class="text-red-800">${cat}</span>
                    <button onclick="removeCategory('expense', '${cat}')" class="text-red-500 hover:text-red-700">
                        üóëÔ∏è
                    </button>
                `;
                expenseList.appendChild(div);
            });
        }

        function addCategory(type) {
            const input = document.getElementById(`new-${type}-category`);
            const newCategory = input.value.trim();
            
            if (newCategory && !categories[type].includes(newCategory)) {
                categories[type].push(newCategory);
                input.value = '';
                loadCategories();
                showToast(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà "${newCategory}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
            }
        }

        function removeCategory(type, category) {
            const index = categories[type].indexOf(category);
            if (index > -1) {
                categories[type].splice(index, 1);
                loadCategories();
                showToast(`‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà "${category}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
            }
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            
            const amount = parseFloat(document.getElementById('amount').value);
            const category = document.getElementById('category').value || document.getElementById('custom-category').value;
            const date = document.getElementById('date').value;
            const note = document.getElementById('note').value;
            
            if (!amount || !category || !date) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }

            const transaction = {
                id: Date.now(),
                type: currentTransactionType,
                amount: amount,
                category: category,
                date: date,
                note: note,
                timestamp: new Date().toISOString()
            };

            transactions.push(transaction);
            
            // Add custom category if used
            if (document.getElementById('custom-category').value && 
                !categories[currentTransactionType].includes(category)) {
                categories[currentTransactionType].push(category);
                loadCategories();
            }
            
            // Reset form
            document.getElementById('transaction-form').reset();
            document.getElementById('date').valueAsDate = new Date();
            
            // Update displays
            applyFilters();
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        function applyFilters() {
            const monthFilter = document.getElementById('month-filter').value;
            const yearFilter = document.getElementById('year-filter').value;
            
            filteredTransactions = transactions.filter(transaction => {
                const transactionDate = new Date(transaction.date);
                const transactionMonth = String(transactionDate.getMonth() + 1).padStart(2, '0');
                const transactionYear = transactionDate.getFullYear();
                
                const monthMatch = !monthFilter || transactionMonth === monthFilter;
                const yearMatch = !yearFilter || transactionYear == yearFilter;
                
                return monthMatch && yearMatch;
            });
            
            updateSummary();
            updateTransactionsTable();
            updateExpenseChart();
        }

        function updateSummary() {
            const income = filteredTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const expenses = filteredTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const balance = income - expenses;
            
            document.getElementById('total-income').textContent = `‡∏ø${income.toLocaleString()}`;
            document.getElementById('total-expenses').textContent = `‡∏ø${expenses.toLocaleString()}`;
            document.getElementById('balance').textContent = `‡∏ø${balance.toLocaleString()}`;
            
            // Update balance color
            const balanceElement = document.getElementById('balance').parentElement.parentElement.parentElement;
            if (balance >= 0) {
                balanceElement.className = balanceElement.className.replace('from-red-400 to-red-500', 'from-blue-400 to-blue-500');
            } else {
                balanceElement.className = balanceElement.className.replace('from-blue-400 to-blue-500', 'from-red-400 to-red-500');
            }
        }

        function updateTransactionsTable() {
            const tbody = document.getElementById('transactions-table');
            tbody.innerHTML = '';
            
            // Sort by date (newest first)
            const sortedTransactions = [...filteredTransactions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedTransactions.forEach((transaction, index) => {
                const row = document.createElement('tr');
                row.className = index % 2 === 0 ? 'bg-gray-50' : 'bg-white';
                
                const formattedDate = new Date(transaction.date).toLocaleDateString('th-TH');
                const amountClass = transaction.type === 'income' ? 'text-green-600' : 'text-red-600';
                const amountPrefix = transaction.type === 'income' ? '+' : '-';
                
                row.innerHTML = `
                    <td class="py-3 px-2 text-sm">${formattedDate}</td>
                    <td class="py-3 px-2 text-sm">${transaction.category}</td>
                    <td class="py-3 px-2 text-sm text-right ${amountClass} font-medium">
                        ${amountPrefix}‡∏ø${transaction.amount.toLocaleString()}
                    </td>
                    <td class="py-3 px-2 text-sm text-gray-600">${transaction.note || '-'}</td>
                    <td class="py-3 px-2 text-center">
                        <button onclick="editTransaction(${transaction.id})" class="text-blue-500 hover:text-blue-700 mr-2">
                            ‚úèÔ∏è
                        </button>
                        <button onclick="deleteTransaction(${transaction.id})" class="text-red-500 hover:text-red-700">
                            üóëÔ∏è
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function updateExpenseChart() {
            const expenseData = {};
            
            filteredTransactions
                .filter(t => t.type === 'expense')
                .forEach(transaction => {
                    expenseData[transaction.category] = (expenseData[transaction.category] || 0) + transaction.amount;
                });
            
            const labels = Object.keys(expenseData);
            const data = Object.values(expenseData);
            const colors = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
            ];
            
            const ctx = document.getElementById('expense-chart').getContext('2d');
            
            if (expenseChart) {
                expenseChart.destroy();
            }
            
            if (labels.length === 0) {
                // Show empty state
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.font = '16px Noto Sans Thai';
                ctx.fillStyle = '#9CA3AF';
                ctx.textAlign = 'center';
                ctx.fillText('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            expenseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: 'Noto Sans Thai'
                                },
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    return data.labels.map((label, i) => ({
                                        text: `${label}: ‡∏ø${data.datasets[0].data[i].toLocaleString()}`,
                                        fillStyle: data.datasets[0].backgroundColor[i],
                                        strokeStyle: data.datasets[0].backgroundColor[i],
                                        lineWidth: 0,
                                        hidden: false,
                                        index: i
                                    }));
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ‡∏ø${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            
            // Fill form with transaction data
            setTransactionType(transaction.type);
            document.getElementById('amount').value = transaction.amount;
            document.getElementById('category').value = transaction.category;
            document.getElementById('date').value = transaction.date;
            document.getElementById('note').value = transaction.note;
            
            // Remove the transaction (will be re-added when form is submitted)
            deleteTransaction(id);
            
            // Switch to dashboard tab
            showTab('dashboard');
            
            showToast('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà');
        }

        function deleteTransaction(id) {
            transactions = transactions.filter(t => t.id !== id);
            applyFilters();
            showToast('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        async function syncWithGoogleSheets() {
            showLoading(true);
            
            try {
                // Send all transactions to Google Sheets
                for (const transaction of transactions) {
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'add',
                            ...transaction
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to sync transaction');
                    }
                }
                
                showToast('‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏±‡∏ö Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                
            } catch (error) {
                console.error('Sync error:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            } finally {
                showLoading(false);
            }
        }

        function loadSampleData() {
            // Add some sample transactions
            const sampleTransactions = [
                {
                    id: 1,
                    type: 'income',
                    amount: 50000,
                    category: '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
                    date: '2024-01-01',
                    note: '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
                    timestamp: new Date().toISOString()
                },
                {
                    id: 2,
                    type: 'expense',
                    amount: 300,
                    category: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
                    date: '2024-01-02',
                    note: '‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á',
                    timestamp: new Date().toISOString()
                },
                {
                    id: 3,
                    type: 'expense',
                    amount: 1500,
                    category: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á',
                    date: '2024-01-03',
                    note: '‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏£‡∏ñ',
                    timestamp: new Date().toISOString()
                }
            ];
            
            transactions = sampleTransactions;
            applyFilters();
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            
            // Update toast color based on type
            const toastDiv = toast.querySelector('div');
            if (type === 'error') {
                toastDiv.className = toastDiv.className.replace('border-green-500', 'border-red-500');
            } else {
                toastDiv.className = toastDiv.className.replace('border-red-500', 'border-green-500');
            }
            
            toast.classList.remove('hidden');
            toast.classList.add('fade-in');
            
            setTimeout(() => {
                toast.classList.add('hidden');
                toast.classList.remove('fade-in');
            }, 3000);
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.remove('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }

        // Google Sheets Integration Functions (Demo)
        async function syncToGoogleSheets() {
            try {
                showLoading(true);
                
                // This would be your actual Google Apps Script URL
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?sheet=‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢`, {
                    method: 'POST',
                    body: JSON.stringify({
                        amount: 200,
                        category: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
                        date: '2024-01-01',
                        note: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö'
                    }),
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.text();
                showToast('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                
            } catch (error) {
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function loadFromGoogleSheets() {
            try {
                showLoading(true);
                
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=read&sheet=transactions`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
                
                const result = await response.json();
                
                if (result.data && Array.isArray(result.data)) {
                    // Convert Google Sheets data to our format
                    transactions = result.data.map(item => ({
                        id: item.id || Date.now() + Math.random(),
                        type: item.type || 'expense',
                        amount: parseFloat(item.amount) || 0,
                        category: item.category || '',
                        date: item.date || new Date().toISOString().split('T')[0],
                        note: item.note || '',
                        timestamp: item.timestamp || new Date().toISOString()
                    }));
                    
                    // Update display
                    applyFilters();
                    showToast(`‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${transactions.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
                } else {
                    showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheets');
                }
                
            } catch (error) {
                console.error('Load error:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            } finally {
                showLoading(false);
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96bcf78a220f45c4',t:'MTc1NDYzNDY0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
