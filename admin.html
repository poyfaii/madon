<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏î‡∏≠‡∏ô‡πÇ‡∏≠‡∏ó‡∏≠‡∏õ - Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body { font-family: 'Kanit', sans-serif; }
    .text-gradient { background: linear-gradient(to right, #10b981, #3b82f6); -webkit-background-clip: text; color: transparent; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-kanit">

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß -->
  <div class="bg-white shadow sticky top-0 z-10 p-4 flex justify-between items-center">
    <h1 class="text-xl md:text-2xl font-extrabold text-gradient">üìä ‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏î‡∏≠‡∏ô‡πÇ‡∏≠‡∏ó‡∏≠‡∏õ - ‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå</h1>
    <button onclick="refreshOrders()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow">
      üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    </button>
  </div>

  <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
  <div class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-6xl mx-auto">
    <div class="bg-green-100 p-4 rounded-xl text-center">
      <p class="text-sm font-bold text-green-800">‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
      <p class="text-3xl font-black text-green-700" id="displayedOrdersCount">0</p>
    </div>
  </div>

  <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå -->
  <div class="max-w-6xl mx-auto px-4 pb-10">
    <div id="ordersList" class="space-y-6"></div>

    <div id="emptyOrdersState" class="hidden text-center py-16">
      <div class="text-6xl text-gray-300 mb-4">üì¶</div>
      <h3 class="text-xl font-bold text-gray-700 mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
      <p class="text-gray-500">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
    </div>
  </div>

  <!-- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå -->
  <script type="module">
    import {
      db,
      collection,
      getDocs,
      orderBy,
      query
    } from './firebase-config.js';

    async function loadOrders() {
      const ordersList = document.getElementById("ordersList");
      const emptyState = document.getElementById("emptyOrdersState");
      const displayedOrdersCount = document.getElementById("displayedOrdersCount");

      try {
        const q = query(collection(db, "orders"), orderBy("createdAt", "desc"));
        const snapshot = await getDocs(q);
        ordersList.innerHTML = "";
        let count = 0;

        snapshot.forEach(doc => {
          const order = doc.data();
          count++;

          const div = document.createElement("div");
          div.className = "border p-4 rounded-xl shadow-md bg-white";
          div.innerHTML = `
            <div class="flex justify-between items-center">
              <div>
                <p class="font-bold text-lg">üë§ ${order.customerName || "-"}</p>
                <p class="text-sm text-gray-600">üì± ${order.customerPhone || "-"}</p>
                <p class="text-sm text-gray-500">${order.status || "‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£"}</p>
              </div>
              <div class="text-right">
                <p class="text-base font-bold text-green-600">${order.total || 0} ‡∏ö‡∏≤‡∏ó</p>
              </div>
            </div>
          `;
          ordersList.appendChild(div);
        });

        displayedOrdersCount.textContent = count;
        emptyState.classList.toggle("hidden", count > 0);
      } catch (error) {
        console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
        ordersList.innerHTML = "";
        emptyState.classList.remove("hidden");
        displayedOrdersCount.textContent = "0";
      }
    }

    window.addEventListener("DOMContentLoaded", loadOrders);
    window.refreshOrders = loadOrders;
  </script>
</body>
</html>